.\" Copyright (c) 1991 The Regents of the University of California.
.\" All rights reserved.
.\"
.\" %sccs.include.redist.man%
.\"
.\"	@(#)pwd_mkdb.8	5.1 (Berkeley) %G%
.\"
.TH PWD_MKDB 8 "
.UC 7
.SH NAME
pwd_mkdb \- generate the password databases
.SH SYNOPSIS
.nf
.ft B
pwd_mkdb [ \-p ] file
.SH DESCRIPTION
.I Pwd_mkdb
creates
.IR db (3)
style secure and insecure databases for the specified file.
These databases are then installed into ``/var/db/spwd.db'' and
``/var/db/pwd.db'' respectively.
The file is installed into ``/etc/master.passwd''.
The file must be in the correct format (see
.IR passwd (5)).
It is important to note that the format used in this system is
different from the historic Version 7 style format.
.PP
The options are as follows:
.TP
\-p
Create a Version 7 style password file and install it into ``/etc/password''.
.PP
The databases actually contain three copies of the original data.
Each password file entry is converted into a rough approximation of a
``struct passwd'', with the strings placed inline.
This object is then stored as the data for three separate keys.
The first key is the pw_name field prepended by the _PW_KEYBYNAME character.
The second key is the pw_uid field prepended by the _PW_KEYBYUID character.
The third key is the line number in the original file prepended by the
_PW_KEYBYNUM character.
(The special characters are prepended to ensure that the keys do not
collide.)
.PP
The two databases differ in that the secure version contains the user's 
encrypted password and the insecure version has an asterisk (``*'')
.PP
The databases are used by the C library password routines (see
.IR getpwent (3)).
.PP
.I Pwd_mkdb
exits zero on success, non-zero on failure.
.SH FILES
/var/db/pwd.db			The insecure password database file
.br
/var/db/pwd.db.tmp		A temporary file
.br
/var/db/spwd.db		The secure password database file
.br
/var/db/spwd.db.tmp		A temporary file
.br
/etc/master.passwd		The current password file
.br
/etc/passwd			A Version 7 format password file
.SH BUGS
Because of the necessity for atomic update of the password files,
.I pwd_mkdb
uses
.IR rename (2)
to install them.
This, however, requires that the file specified on the command line live
on the same file system as the ``/etc'' directory.
.PP
There are the obvious races with multiple people running
.I pwd_mkdb
on different password files at the same time.
The front-ends to 
.IR pwd_mkdb ,
.IR chpass (1),
.IR passwd (1)
and
.IR vipw (8),
handle the locking necessary to avoid this problem.
.SH COMPATIBILITY
Previous versions of the system had a program similar to
.I pwd_mkdb, 
.IR mkpasswd (8),
which built
.I dbm (3)
style databases for the password file but depended on the calling programs
to install them.
The program was renamed in order that previous users of the program
not be surprised by the changes in functionality.
.SH SEE ALSO
chpass(1), passwd(1), db(3), getpwent(3), passwd(5), vipw(8)
