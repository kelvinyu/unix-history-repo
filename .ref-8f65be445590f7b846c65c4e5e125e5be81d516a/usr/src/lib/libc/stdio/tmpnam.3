.\" Copyright (c) 1988 The Regents of the University of California.
.\" All rights reserved.
.\"
.\" %sccs.include.redist.man%
.\"
.\"	@(#)tmpnam.3	5.11 (Berkeley) %G%
.\"
.TH TMPFILE 3 ""
.UC 7
.SH NAME
tempnam, tmpfile, tmpnam \- temporary file routines
.SH SYNOPSIS
.nf
.ft B
#include <stdio.h>

FILE *
tmpfile(void);

char *
tmpnam(char *str);

char *
tempnam(const char *tmpdir, const char *prefix);
.ft R
.fi
.SH DESCRIPTION
.I Tmpfile
returns a pointer to a stream associated with a file descriptor returned
by the routine
.IR mkstemp (3).
The created file is unlinked before
.I tmpfile
returns, causing the file to be automatically deleted when the last
reference to it is closed.
The file is opened with the access value ``w+''.
.PP
.I Tmpnam
returns a pointer to a file name, in the ``P_tmpdir'' directory, which
did not reference an existing file at some indeterminate point in the
past.
P_tmpdir is defined in the include file <stdio.h>.
If the argument
.I s
is non-NULL, the file name is copied to the buffer it references.
Otherwise, the file name is copied to a static buffer.
In either case,
.I tmpnam
returns a pointer to the file name.
.PP
The buffer referenced by 
.I s
is expected to be at least ``L_tmpnam'' bytes in length.
L_tmpnam is defined in the include file <stdio.h>.
.PP
.I Tempnam
is similar to
.I tmpnam,
but provides the ability to specify the directory which will
contain the temporary file and the file name prefix.
.PP
The environmental variable ``TMPDIR'' (if set), the argument
.I dir
(if non-NULL), the directory P_tmpdir, and the directory ``/tmp''
are tried, in the listed order, as directories in which to store the
temporary file.
.PP
The argument
.IR prefix ,
if non-NULL, is used to specify a file name prefix, which will be the
first part of the created file name.
.I Tempnam
allocates memory in which to store the file name; the returned pointer
may be used as a subsequent argument to
.IR free (3).
.SH "RETURN VALUES"
.I Tmpfile
returns a pointer to an open file stream on success, and a NULL pointer
on error.
.PP
.I Tmpnam
and
.I tempfile
return a pointer to a file name on success, and a NULL pointer
on error.
.SH ERRORS
.I Tmpfile
may fail and set
.I errno
for any of the errors specified for the library functions
.IR fdopen (3)
or
.IR mkstemp (3).
.PP
.I Tmpnam
may fail and set
.I errno
for any of the errors specified for the library function
.IR mktemp (3).
.PP
.I Tempnam
may fail and set
.I errno
for any of the errors specified for the library functions
.IR malloc (3)
or
.IR mktemp (3).
.SH BUGS
These interfaces are provided for System V and ANSI compatibility only.
The
.IR mkstemp (3)
interface is strongly preferred.
.PP
There are four important problems with these interfaces (as well as
with the historic
.IR mktemp (3)
interface).
First, there is an obvious race between file name selection and file
creation and deletion.
Second, most historic implementations provide only a limited number
of possible temporary file names (usually 26) before file names will
start being recycled.
Third, the System V implementations of these functions (and of
.IR mktemp )
use the
.IR access (2)
function to determine whether or not the temporary file may be created.
This has obvious ramifications for setuid or setgid programs, complicating
the portable use of these interfaces in such programs.
Finally, there is no specification of the permissions with which the
temporary files are created.
.PP
This implementation does not have these flaws, but portable software
cannot depend on that.
In particular, the
.I tmpfile
interface should not be used in software expected to be used on other systems
if there is any possibility that the user does not wish the temporary file to
be publicly readable and writable.
.SH STANDARDS
.I Tmpfile
and
.I tmpnam
conform to ANSI X3.159-1989 (``ANSI C'').
.SH SEE ALSO
mkstemp(3), mktemp(3)
